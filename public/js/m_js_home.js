"use strict";function HomePage(n){this.option=n;this.productSwipers=[];this.incredibleEndDateTime=null;this.currentDate=this.option.currentDate;this.elastic=n.elastic;this._init()}function setincrediblePriceShow(n){if(n<10)return"0";for(var t=n/10;t>=1e3;)t=t/1e3;return t=t.toString().substring(0,5),t.length==4&&t.indexOf(".")===1?t+="0":t.indexOf(".")===3&&t.substring(4,5)==="0"&&(t=t.substr(0,3)),t}function setincrediblePriceTitle(n){if(n<10)return"تومان";for(var r=["تومان","هزار تومان","میلیون تومان","میلیارد تومان"],t=0,u=r[t],i=n/10;i>=1e3;)t++,i=i/1e3;return r[t]}(function(n){function t(t,i){this.$element=n(t);this.$wrapper=this.$element.children(".swiper-wrapper");this.options=i;this.index=0;this.dotIndex=0;this.options.loop&&(this.$itemBeforeAttach=this.$wrapper.children(".swiper-slide"),this.$first=this.$itemBeforeAttach.filter(":first"),this.$last=this.$itemBeforeAttach.filter(":last"),this.$wrapper.prepend(this.$last.clone(!0)),this.$wrapper.append(this.$first.clone(!0)),this.index=1);this.$item=this.$wrapper.children(".swiper-slide");this.activeSwipeButton=this.$item.length>5?!0:!1;this._init()}t.prototype={_init:function(){var r,i,t;if(this.busy=!1,this.startX=null,r=this.$item.width(),this.options.loop&&this.$wrapper.css("transform","translate3d("+r+"px,0,0)"),this.attachEvent(),this.options.autoPlay&&this.interval(),this.options.scrollBar&&this.$item.length>1){for(i="",t=0;t<this.$item.length;t++)if(i+="<i><\/i>",t==4)break;n(i).appendTo(this.options.scrollBarTag.children(".swiper-dots"));n('<span class="swiper-next"><\/span><span class="swiper-prev"><\/span>').appendTo(this.options.scrollBarTag);this.options.scrollBarTag.find("i").eq(0).addClass("active").siblings().removeClass("active")}},changeSlide:function(t){if(!this.busy){this.busy=!0;this.direction=t;var i=this.$item.width();t=="next"?this.index<this.$item.length-1?++this.index:this.index=this.options.loop?-0:this.$item.length-1:this.index<=0?this.index=0:--this.index;this.$wrapper.css("transition","transform 0.3s cubic-bezier(.66,.14,.12,.9)");this.$wrapper.css("transform","translate3d("+this.index*i+"px,0,0)");this.options.scrollBar&&this.changeNavigation();setTimeout(n.proxy(function(){this.options.loop&&(t=="next"&&this.index==this.$item.length-1?(this.index=1,this.$wrapper.css("transition","transform 0s")):t=="prev"&&this.index==0&&(this.index=this.$item.length-2,this.$wrapper.css("transition","transform 0s")),this.$wrapper.css("transform","translate3d("+this.index*i+"px,0,0)"));this.busy=!1},this),300)}},changeNavigation:function(){this.direction=="next"?(this.options.scrollBarTag.find("i.active").not(":last-child").removeClass("active").next().addClass("active"),this.dotIndex=this.options.scrollBarTag.find("i.active").index(),this.options.scrollBarTag.find(".swiper-prev").removeClass("active"),this.index==this.$item.length-1?this.options.scrollBarTag.find(".swiper-next").removeClass("active"):this.index>=this.options.scrollBarTag.find("i").length-1&&this.options.scrollBarTag.find(".swiper-next").addClass("active")):(this.options.scrollBarTag.find("i.active").not(":first-child").removeClass("active").prev().addClass("active"),this.dotIndex=this.options.scrollBarTag.find("i.active").index(),this.options.scrollBarTag.find(".swiper-next").removeClass("active"),this.dotIndex==0&&this.index>0?this.options.scrollBarTag.find(".swiper-prev").addClass("active"):this.options.scrollBarTag.find(".swiper-prev").removeClass("active"))},attachEvent:function(){this.$element.on("touchstart",n.proxy(function(n){this.startX=n.originalEvent.changedTouches[0].pageX},this));this.$element.on("touchend",n.proxy(function(n){this.endX=n.originalEvent.changedTouches[0].pageX;this.movex=this.index*this.$item.width()+(this.startX-this.endX);var t=Math.abs(this.endX)-this.startX;Math.abs(t)>this.options.threshold&&(clearInterval(this.sliderInterval),Math.abs(this.endX)>this.startX?this.changeSlide("next"):Math.abs(this.endX)<this.startX&&this.changeSlide("prev"),this.options.autoPlay&&setTimeout(this.interval(),1e3))},this))},interval:function(){this.sliderInterval=setInterval(n.proxy(function(){this.changeSlide("next")},this),this.options.duration)}};n.fn.touchslider=function(i){var r,u;return typeof i=="string"?(r=this.data("touchslider"),r&&(u=r[i].apply(r,Array.prototype.slice.call(arguments,1)),u))?u:this:(i=n.extend({},n.fn.touchslider.defaults,i),this.each(function(){var r=n.data(this,"touchslider");r||(r=new t(this,i),n.data(this,"touchslider",r))}))};n.fn.touchslider.defaults={autoPlay:!1,nav:!1,threshold:50,duration:4500,scrollBar:!1,scrollBarTag:null,loop:!1}})(jQuery,window,document);HomePage.prototype={_objectList:[],_totalWeight:0,_itemIndex:0,_init:function(){this._showApplicationsIcons();this._getElasticContent();this._getProfileHiddenInput();this._showHelpBtn()},getPromotionData:function(){var n=this;return $.get(SearchServiceUrl+"api2/data/GetPromCenter",function(t){if(t.responses[0]||!t.responses[0].hits.hits.length){var i=[];t.responses[0].hits.hits.forEach(function(n){i.push(FileServerUrl+n._source.ProductImagePath.replace("/Original/","/64/"))});n.option.promotionImages=i}})},renderingPromotion:function(n){var t=this.option.promotionImages.slice(0),o=this,f,r,i,u,e;for($(".promotion").removeClass("promotion--hidden"),f="<span class='promotion__item' data-index='${index}'><span class='_inner'><img  src='${source.replace('/Original/', '/64/')}' /><\/span><\/span>",r="",i=0;i<4;i++)u=t[Math.floor(Math.random()*t.length)],r+=f.template({source:u,index:i}),t.splice(t.indexOf(u),1);$(r).appendTo($(n.selector));e=document.querySelectorAll(".promotion__item img");e.forEach(function(n){o.initializePromotionAnimation(n)})},initializePromotionAnimation:function(n){var t=this;setTimeout(function(){var i=function(i){i.style.opacity=1;var f=+new Date,u=function(){i.style.opacity=+i.style.opacity-(new Date-f)/400;f=+new Date;+i.style.opacity>0?window.requestAnimationFrame&&requestAnimationFrame(u)||setTimeout(u,16):($(n).attr("src",t.option.promotionImages[Math.floor(Math.random()*t.option.promotionImages.length)]),setTimeout(function(){r(i)},500))};u()},r=function(n){n.style.opacity=0;var r=+new Date,t=function(){n.style.opacity=+n.style.opacity+(new Date-r)/400;r=+new Date;+n.style.opacity<1?window.requestAnimationFrame&&requestAnimationFrame(t)||setTimeout(t,16):setTimeout(function(){i(n)},2e3)};t()};i(n)},Math.floor(Math.random()*1301)+700)},_getProfileHiddenInput:function(){$("#order__list").on("click",function(){document.getElementById("profile_feature").value="1"})},_getElasticContent:function(){var e=this,r,u,f,t,n,i;for(this.elastic.banners&&this.elastic.banners.responses[2].hits.hits&&(r=this.getWeightedRandomItem(this.elastic.banners.responses[2].hits.hits,6),this._swiperMainSlider(r)),this.elastic.inredibles&&this.elastic.inredibles.responses[0].hits.hits[0]?(this.incredibleEndDateTime=this.elastic.inredibles.responses[0].hits.hits[0]._source.EndDateTime,this._swiperIncredible(this.elastic.inredibles.responses[0].hits.hits),this._amazingTimer()):$("div.carousel--incredible").hide(),this.elastic.shortcuts&&this.elastic.shortcuts.responses[1].hits.hits&&this.elastic.shortcuts.responses[2].hits.hits&&(u=this.getWeightedRandomItem(this.elastic.shortcuts.responses[1].hits.hits,4),f=this.getWeightedRandomItem(this.elastic.shortcuts.responses[2].hits.hits,2),this._homeShortcut(u,f)),t=$("div.carousel[data-type]"),n=0;n<t.length;n++){i=parseInt($(t[n]).data("type"));switch(i){case 7:this._productsCarouselList(t[n],this.elastic.bestSellers.hits.hits,i,0);break;case 3:this._productsCarouselList(t[n],this.elastic.latest.hits.hits,i,0);break;case 4:this._productsCarouselList(t[n],this.elastic.mostViewed.hits.hits,i,0)}}},_getElasticProducts:function(n,t,i){this._productsCarouselList(n,data.hits.hits,t,i)},_swiperMainSlider:function(n){var u=this,i,r,t;if(n.length){for(i="",r="<div class='swiper-slide'><div class='slide-holder'><a elementType='${BannerType}' categoryTitle='${Description}' bannerId='${Id}' href='${Link}'><div class='thumb-holder'><img class='img-responsive' src='"+this.option.FileServerUrl+"${BannerPath}' ><\/div><\/a><\/div><\/div>",t=0;t<n.length;t++)i+=r.template({BannerType:n[t]._source.BannerType,Description:n[t]._source.Description,Id:n[t]._source.BannerId,Link:n[t]._source.LinkValue,BannerPath:n[t]._source.BannerPathMobile});document.getElementById("dk-home-slider_main").children[0].innerHTML=i;$("#dk-home-slider_main").touchslider({autoPlay:!0,loop:!0})}},_swiperIncredible:function(n){var t;if(n.length){var r="<a class='carousel__item incredible' href='/Product/DKP-${ProductId}/${Url}' title='${FaTitle} - ${EnTitle}'><span class='incredible__title'>${Title}<\/span>${ExistStatus}${ExistStatusClass}${HasGift}<span class='_wrapper'><img class='incredible__image' src='"+this.option.FileServerUrl+"${Image_Path}'/><\/span><div><svg class=\"incredible__label\" width=\"135\" height=\"20\"><use xlink:href=\"#icon-incredible-title\"><\/use><\/svg><span class='incredible__price ${ Price == 0 ? 'invisible' : ''}'><span class='incredible__price--old'>${PublicClass.convertToFaDigit(String(Price))}<\/span><span class='incredible__price--final'>${PublicClass.convertToFaDigit(String(NewPrice))}<span class='currency'>${USD}<\/span><\/span><\/span><\/div><\/a>",i="";for(t=0;t<n.length;t++)i+=n[t]._source.OnlyForMembers&&isLogined==="false"?'<div class=\'carousel__item incredible incredible--secretdeal secretdeal\' onClick="$(\'div[data-popup=login-panel]\').popup(\'_create\')"><svg class="secretdeal__label" width="165" height="20"><use xlink:href="#icon-incredible-title-secret"><\/use><\/svg><svg class="secretdeal__icon icon-secret-deal" width="100" height="85"><use xlink:href="#icon-secret-deal"><\/use><\/svg><span>برای دیدن این پیشنهاد لطفا وارد شوید<\/span><span class=\'secretdeal__title\'>پیشنهاد شگفت انگیز ویژه<\/span><\/div>'.template():r.template({ExistStatus:n[t]._source.ExistStatus==3?"<img class='incredible__finishLabel' src='"+this.option.TemplateServerUrl+"/DigikalaMobileWeb/Content/dist/images/Finished_Badge.png'>":"",ProductId:n[t]._source.ProductId,EnTitle:fixTextForUrl(n[t]._source.EnTitle),FaTitle:fixTextForUrl(n[t]._source.FaTitle),ExistStatusClass:n[t]._source.ExistStatus==3?"<div class='incredible__finishEffect'><\/div>":"",HasGift:n[t]._source.HasGift?'<i class="incredible__giftLabel"><svg class="icon-plus-gift"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-plus-gift"><\/use><\/svg><svg class="icon-Gift-svg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-Gift"><\/use><\/svg><\/i>':"",Price:setincrediblePriceShow(n[t]._source.Price),NewPrice:n[t]._source.Price>0?setincrediblePriceShow(n[t]._source.Price-n[t]._source.Discount):setincrediblePriceShow(n[t]._source.Price),USD:n[t]._source.Price>0?setincrediblePriceTitle(n[t]._source.Price-n[t]._source.Discount):setincrediblePriceTitle(n[t]._source.Price),Image_Path:n[t]._source.ProductImagePath.replace("/Original/","/150/"),Title:n[t]._source.Title,Url:n[t]._source.ShowType==1?fixTextForUrl(n[t]._source.EnTitle):fixTextForUrl(n[t]._source.FaTitle)});$("div.carousel--incredible").find("div.carousel__list").html(i)}},_homeShortcut:function(n,t){var e=$("#dk-shortcuts-category"),u,f,i,r;if(n.length==4&&t.length==2&&$(".carousel").length>0){for(u=0,f=0;f<t.length;f++)i="",i+="<div class='shortcut shortcut--full'>",i+="<a href='"+t[f]._source.Link.replace("http://www.digikala.com/","/").replace("https://www.digikala.com/","/")+"'>",i+="<img src='"+this.option.FileServerUrl+t[f]._source.BannerPath+"'><\/a><\/div>",this.option.isCategoryPage?$(i).insertBefore($(".carousel").eq(u)):$(i).insertAfter($(".carousel").eq(u)),u=u+2;for(i="",r=0;r<4;r++)i+="<div class='shortcut shortcut--half "+(r%2==0?"shortcut--first":"shortcut--last")+"'>",i+="<a href='"+n[r]._source.Link.replace("http://www.digikala.com/","/").replace("https://www.digikala.com/","/")+"'>",i+="<img src='"+this.option.FileServerUrl+n[r]._source.BannerPath+"'><\/a><\/div>",r%2!=0&&(this.option.isCategoryPage?$(i).insertBefore($(".carousel").eq(r)):$(i).insertAfter($(".carousel").eq(r)),i="")}},_productsCarouselList:function(n,t,i,r){for(var e=this,f="",u=0;u<t.length;u++)f+='<a class="carousel__item product" href="/Product/DKP-${Id}/${Url}" title="${FaTitle}"><img src="${Fixpath}" class="product__image" title="${MyTitle}"><h2 class="product__title ${TitleClass}">${MyTitle}<\/h2>${OldPrice}<span class="product__price product__price--final">${FinalPrice} تومان <\/span><\/a>'.template({Id:t[u]._source.Id,EnTitle:fixTextForUrl(t[u]._source.EnTitle),FaTitle:fixTextForUrl(t[u]._source.FaTitle),Fixpath:t[u]._source.ImagePath?this.option.FileServerUrl+fixPath(t[u]._source.ImagePath,"150"):this.option.TemplateServerUrl+"DigikalaMobileWeb/Content/dist/images/placeholder120.jpg",TitleClass:t[u]._source.ShowType==1?"product__title--en":"product__title--fa",MyTitle:t[u]._source.ShowType==1?t[u]._source.EnTitle:t[u]._source.FaTitle,OldPrice:t[u]._source.MinPriceList>0?'<span class="product__price product__price--old">'+convertToFaDigit(formatCurrency(t[u]._source.MinPriceList,!0,""))+"<\/span>":"",FinalPrice:convertToFaDigit(formatCurrency(t[u]._source.MinPrice,!0,"")),Url:t[u]._source.ShowType==1?fixTextForUrl(t[u]._source.EnTitle):fixTextForUrl(t[u]._source.FaTitle)});r==0&&$(n).find(".trading-items").html(f)},_amazingTimer:function(){var t=$("#incredible-timer"),i=new Date(new Date(this.incredibleEndDateTime+"Z").valueOf()+new Date(this.incredibleEndDateTime+"Z").getTimezoneOffset()*6e4),r=new Date(this.currentDate),u=Math.abs(i.getTime()-r.getTime())/1e3,n=function(n){n=Number(n);var t=Math.floor(n/3600),i=Math.floor(n%3600/60);return{h:("0"+t).slice(-2),m:("0"+i).slice(-2)}}(u),f='<span class="hours counter"><span>${h}<\/span><span>ساعت<\/span><\/span> <span class="spacer">:<\/span> <span class="minutes counter"><span>${m}<\/span><span>دقیقه<\/span><\/span>'.template({h:PublicClass.convertToFaDigit(String(n.h)),m:PublicClass.convertToFaDigit(String(n.m))});t.html(f)},_showApplicationsIcons:function(){var n=$("#dk-application_box"),t=n.find("a"),i=navigator.userAgent.match(/iPhone|iPad|iPod/i),r=navigator.userAgent.match(/Android/i);if(readCookie("showAppIcon")!="true"&&(i!=null||r!=null)){n.show();i!=null&&t.attr({rel:"nofollow",href:"https://itunes.apple.com/us/app/digikala-big-store-in-your/id1016290651?mt=8"});r!=null&&t.attr({rel:"nofollow",href:"https://cafebazaar.ir/app/com.digikala/?l=fa"});n.find(".icon-close").on("click",function(){n.hide();document.cookie="showAppIcon=true"})}},_tourGuide:function(){$("body").addClass("disable-scroll");localStorage.setItem("homeGuide",!0);$(".cd-product-container").addClass("open")},_showHelpBtn:function(){var n=this;$("#tourPreview").on("click",function(n){$("body").addClass("disable-scroll");n.preventDefault();localStorage.setItem("listGuide",!1);localStorage.setItem("homeGuide",!1);localStorage.setItem("productGuide",!1);localStorage.setItem("productgalleryGuide",!1);localStorage.setItem("cartGuide",!1);localStorage.setItem("shippingGuide",!1);localStorage.setItem("reviewGuide",!1);localStorage.setItem("paymentGuide",!1);$(".cd-product-container").addClass("open")});$("#pageHelp").on("click",function(t){t.preventDefault();n._tourGuide();$(".user-profile-panel_mo").popup("_close");$("body").addClass("disable-scroll")})},weightedRandomList:function(n){for(var t=0;t<n.length;t++)n[t].sumWeight=t===0?n[t]._source.DisplayWeight:n[t-1].sumWeight+n[t]._source.DisplayWeight,this._totalWeight=n[t].sumWeight,this._objectList.push(n[t])},getWeightedRandomItem:function(n,t){var i,u,f;this._itemIndex=0;this._objectList=[];var e=[],r=[],o=[],s=0;for(i=0;i<n.length;i++)n[i]._source.DisplayWeight===100?(r.push(n[i]),s++):o.push(n[i]);if(r.length>=t){while(r.length!=t)r.pop();return r}if(t=t-s,this.weightedRandomList(o),this._objectList.length<=t){for(i=0;i<this._objectList.length;i++)r.push(this._objectList[i]);return r}for(i=0;i<t;i++)e.push(Math.floor(Math.random()*this._totalWeight)+1);for(e.sort(function(n,t){return n-t}),i=0;i<t;i++){if(u=this.getItemByWeight(e[i]),u!==null)for(f=0;f<r.length;f++)if(r[f]._source.BannerId===u._source.BannerId){u=null;break}while(u===null)if(this._itemIndex=0,u=this.getItemByWeight(Math.floor(Math.random()*this._totalWeight)+1),u!==null)for(f=0;f<r.length;f++)if(r[f]._source.BannerId===u._source.BannerId){u=null;break}r.push(u)}return r},getItemByWeight:function(n){for(var t=null;this._itemIndex<this._objectList.length;){if(this._objectList[this._itemIndex].sumWeight>=n){t=this._objectList[this._itemIndex];this._itemIndex++;break}this._itemIndex++}return t},shuffleArray:function(n){for(var i,r,t=n.length;t;t-=1)i=Math.floor(Math.random()*t),r=n[t-1],n[t-1]=n[i],n[i]=r;return n},_showAppBanner:function(){if(typeof this._getAppCookie("appBanner")=="undefined"){var n=new Date,t=n.getTime();t+=864e5;n.setTime(t);document.cookie="appBanner=true; expires="+n.toUTCString()+"; path=/"}this._getAppCookie("appBanner")=="true"?(alert("dd"),$("#appBanner").removeClass("display-none")):$("#appBanner").addClass("display-none");$("#appBanner").find("svg").on("click",function(){$(this).parent().addClass("display-none");document.cookie="appBanner=false"})},_getAppCookie:function(n){var i="; "+document.cookie,t=i.split("; "+n+"=");if(t.length==2)return console.log(t.pop().split(";").shift()),t.pop().split(";").shift()}}