"use strict";(function($,window,document,undefined){function Popup(element,options){this.$element=$(element);this.options=options;this.$cancelBtn=this.options.closeButton||this.$element.find(".cancel");this.isOpen=false;this.$overlay=$('<div class="dialog__overlay">').attr("data-popup",this.$element.attr("data-popup"));this.$element.bind("afterOpen",this.options.afterOpen);this.$element.bind("onClose",this.options.onClose);this.$element.bind("onOpen",this.options.onOpen);this._init();}Popup.prototype={_init:function(){window.InstanceCollection=window.InstanceCollection||[];window.InstanceCollection.push(this.$element);if(this.options.modal){this.$overlay.appendTo(document.body);}this.$popupButtonHandler=$('[data-type="popup-handler"]').filter("[data-popup="+this.$element.attr("data-popup")+"]").not(".disabled");this.$popupButtonHandler.on("click",$.proxy(function(e){if(this.options.addActiveClass){this.$popupButtonHandler.addClass("panel-active");this.$element.addClass("panel-active");}this._create();e.preventDefault();},this));this.$cancelBtn.on("click",$.proxy(function(){this._close();},this));this.attachEvent();var self=this;$(window).on("popstate",$.proxy(function(event){if(!this.isOpen){return;}if(this.options.updateHistory){this._close();}},this));},_create:function(){if(this.options.updateHistory){if(history.state&&history.state.hasOwnProperty("isPopupActive")){history.replaceState({isPopupActive:true},"popup","#popup");}else{history.pushState({isPopupActive:true},"popup","#popup");}}if(this.isOpen){this._close();}else{InstanceCollection.forEach(function(popup){var instance=popup.data("popup");if(instance.isOpen){instance._close.apply(instance,Array.prototype.slice.call(arguments,1));}});this.$element.trigger("onOpen",[this,this.$element]);if(this.options.disableHeaderShadow){$("#dk-header_mo").addClass("disable-shadow");}this.$overlay.addClass("open");this.$element.removeClass("dialog--close").addClass("dialog--open");this.isOpen=!this.isOpen;if(this.options.disableBodyScroll){$(document.body).addClass("disable-scroll");}}},_close:function(historyBack){if(history.state&&history.state.hasOwnProperty("isPopupActive")&&(historyBack==undefined||historyBack>1)&&this.options.updateHistory){history.back();}this.$element.addClass("dialog--close").removeClass("dialog--open");$("#dk-header_mo").removeClass("disable-shadow");$(document.body).removeClass("disable-scroll");this.$overlay.removeClass("open");this.$element.removeClass("panel-active");this.$popupButtonHandler.removeClass("panel-active");this.isOpen=false;this.$element.trigger("onClose",[this,this.$element]);},attachEvent:function(){this.$overlay.on("click",$.proxy(function(){this._close();},this));}};$.fn.popup=function(options){if(typeof options=="string"){var plugin=this.data("popup");if(plugin){var r=plugin[options].apply(plugin,Array.prototype.slice.call(arguments,1));if(r){return r;}}return this;}options=$.extend({},$.fn.popup.defaults,options);return this.each(function(){var plugin=$.data(this,"popup");if(!plugin){plugin=new Popup(this,options);$.data(this,"popup",plugin);}});};$.fn.popup.defaults={modal:true,disableHeaderShadow:true,addActiveClass:false,disableBodyScroll:false,afterOpen:null,onClose:null,onOpen:null,closeButton:null,updateHistory:false};})(jQuery,window,document);